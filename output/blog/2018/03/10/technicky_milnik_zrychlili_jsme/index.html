<!DOCTYPE html>
<html lang="en">
<head>
    <title>TechnickÃ½ milnÃ­k - zrychlili jsme | DrD+</title>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">

        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">

                    <meta property="og:type" content="article"/>
        <meta property="og:title" content="TechnickÃ½ milnÃ­k - zrychlili jsme"/>
        <meta property="og:description" content=""/>
        <meta property="og:url" content="https://blog.drdplus.info/blog/2018/03/10/technicky_milnik_zrychlili_jsme"/>
        
                <meta name="twitter:card" content="summary"/>
        <meta name="twitter:site" content="@votrubaT">
        <meta name="twitter:title" content="TechnickÃ½ milnÃ­k - zrychlili jsme"/>
        <meta name="twitter:description" content=""/>
            
    <link rel="alternate" type="application/rss+xml" title="DrD+ Blog RSS" href="/rss.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/font-awesome.5.0.13/css/fontawesome-all.min.css">

    <link href="/assets/bootstrap-4.0.0/bootstrap.min.css?v=1767480984" rel="stylesheet" type="text/css"/>

    <link href="/assets/prism/prism.css?v=1895025542" rel="stylesheet" type="text/css"/>

        <link href="/assets/css/style.css?v=229122399" rel="stylesheet" type="text/css"/>

    <link href="/assets/gifplayer/gifplayer.css" rel="stylesheet" type="text/css"/>

        <link href="/assets/css/checklist.css?v=472830164" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="/assets/js/redirect.js?version=f7d8faed35ad4e3c8a25378c7d8c88da"></script>
</head>
<body>
<div class="background-image"></div>
<!-- post_id: 2018-03-10-1 -->

<div class="container-fluid no-padding-md-down">
    <nav class="navbar">
        <ul>
            <li>
                <a href="https://www.drdplus.info">
                    <img src="/assets/images/red_dragon_128.png" alt="Red dragon" class="inline-image">
                    <span class="hidden-sm-down">DrdPlus.info</span>
                </a>
            </li>
            <li class="active">
                <a href="/">Blog</a>
            </li>
            <li class="">
                <a href="/kontakt/">Kontakty</a>
            </li>
            <li id="top-menu-search" class="hidden-xs-down">
                <form method="get" action="https://www.google.com/search" itemprop="potentialAction" itemscope=""
                      itemtype="http://schema.org/SearchAction">
                    <meta itemprop="target" content="https://www.google.com/search?q={q}"/>
                    <input name="sitesearch" value="blog.drdplus.info" type="hidden"/>
                    <input itemprop="query-input" type="text" id="search-query" class="form-control" required="required"
                           name="q" placeholder="Hledej..." autocomplete="off"/>
                </form>
            </li>
        </ul>
    </nav>
</div>
<div class="mainContent">
    <div class="container-fluid" id="post">
        <h1>TechnickÃ½ milnÃ­k - zrychlili jsme</h1>

        <ul class="list-inline post-metadata">
    <li class="list-inline-item mr-3" title="ÄŒasovÃ¡ nÃ¡roÄnost">
        <em class="fas fa-clock fa-fw"></em>
        ğŸ™‚
    </li>

    <li class="list-inline-item mr-3" title="Datum">
        <em class="fas fa-calendar fa-fw"></em>
        <time datetime="2018-03-Sat">
                            10. 3. 2018
                    </time>
    </li>

    
            <li class="list-inline-item">
            <em class="fas fa-fw fa-edit"></em>
            <a href="https://github.com/drdplusinfo/blog/edit/master/source/_posts/2018/2018-03-10-technicky_milnik_zrychlili_jsme.md">PÅ™eklep? Oprav mÄ›, prosÃ­m</a>
        </li>
    
    
    </ul>

        
        
        
        
        <h2 id="poznej-kdo-ti-slouzi"><a href="#poznej-kdo-ti-slouzi" class="heading-anchor">Poznej, kdo ti slouÅ¾Ã­</a></h2>


<p>Budoucnost DrD+ zÃ¡visÃ­ na mnoha faktorech a jeden z nich je <em>dostupnost</em> pravidel.<br>
V tomhle ÄlÃ¡nku ti proto popÃ­Å¡u, jak strÃ¡nky fungujÃ­ po technickÃ©, ajÅ¥Ã¡ckÃ© strÃ¡nce, a to jak je posÃ­lÃ¡ server a jak je Äte tvÅ¯j prohlÃ­Å¾eÄ, protoÅ¾e i v tom je kus dÅ¯leÅ¾itÃ© historie a jeÅ¡tÄ› dÅ¯leÅ¾itÄ›jÅ¡Ã­ <em>budoucnosti</em> <a href="https://www.drdplus.info">drdplus.info</a>.</p>


<p>ÄŒlÃ¡nek jsem psal dost zjednoduÅ¡enÄ›, takÅ¾e detaily pochopÃ­Å¡, i kdyÅ¾ <em>nejsi od fochu</em>.</p>


<hr>

<blockquote>
<p>Na zaÄÃ¡tku to ucpÃ¡valo drÃ¡ty, na konci to bude jako offline aplikace v telefonu.</p>
</blockquote>


<h2 id="pomaly-rozjezd"><a href="#pomaly-rozjezd" class="heading-anchor">PomalÃ½ rozjezd</a></h2>


<p>2014</p>


<p><em>To zÃ¡kladnÃ­ bychom mÄ›li, strÃ¡nky se naÄÃ­taly, aaaleee pooomaaaluuu</em></p>


<p>Jak uÅ¾ jsem <a href="../../../../2017/08/02/ptam_se_bouchiho_z_altaru_zda_mohu_zverejnit_drd_pravidla/">psal v dopise Altaru</a>, zaÄÃ¡tky strÃ¡nek <a href="https://www.drdplus.info">drdplus.info</a> byly tristnÃ­. <a href="https://pph.drdplus.info/?trial=1">PPH</a> se naÄÃ­taly tak dlouho, Å¾e jsem rychleji vyhrabal <a href="https://obchod.altar.cz/drd-prirucka-pro-hrace-everze-p-972.html?buy=Koup%C3%ADm+DrD%2B+PPH+%28Pravidla+pro+hr%C3%A1%C4%8De%29">pÅ¯vodnÃ­ PDFko</a> a v nÄ›m si naÅ¡el co jsem hledal.<br>
No, trochu mÄ› to otrÃ¡vilo, takÅ¾e jsem se na pravidla na webu na Äas vykvajznul...</p>


<h2 id="posilame-casti-najednou"><a href="#posilame-casti-najednou" class="heading-anchor">PosÃ­lÃ¡me ÄÃ¡sti najednou</a></h2>


<p>2016</p>


<p><em>Jak dostat strÃ¡nku rychleji do tvÃ©ho prohlÃ­Å¾eÄe?</em></p>


<p>MalÃ¡ revoluce pro mÄ› nastala objevenÃ­m <a href="https://caddyserver.com/">webovÃ©ho serveru Caddy</a>, kterÃ©mu staÄilo <a href="https://caddyserver.com/tutorial/caddyfile">nepÅ™Ã­liÅ¡ sloÅ¾itÃ½m textovÃ½m souborem</a> oznÃ¡mit, co chci zobrazovat, a najednou jsem mÄ›l strÃ¡nky s <a href="https://www.vzhurudolu.cz/prirucka/https">HTTPS</a> a jeÅ¡tÄ› k tomu se naÄÃ­taly rychleji, jelikoÅ¾ vyuÅ¾Ã­valy <a href="https://www.vzhurudolu.cz/prirucka/http-2">HTTP/2</a>, coÅ¾ je stahovÃ¡nÃ­ vÅ¡ech ÄÃ¡stÃ­ strÃ¡nky <em>najednou</em> (tÅ™eba takovÃ¡ <a href="https://pph.drdplus.info/?trial=1">Pravidla pro hrÃ¡Äe</a> jsou sloÅ¾ena z padesÃ¡ti devÃ­ti ÄÃ¡stÃ­ a stahovat je po jednÃ©, nebo vÅ¡echny najednou, to uÅ¾ je rozdÃ­l).</p>


<h4 id="samocinne-nacitani-zmen"><a href="#samocinne-nacitani-zmen" class="heading-anchor">SamoÄinnÃ© naÄÃ­tÃ¡nÃ­ zmÄ›n</a></h4>


<p><em>Co mÅ¯Å¾e dÄ›lat stroj, nedÄ›lej</em></p>


<p>NavÃ­c uÅ¾ mÃ¡ <a href="https://caddyserver.com/">Caddy</a> spoustu rozÅ¡Ã­Å™enÃ­ a kupÅ™Ã­kladu <a href="https://caddyserver.com/docs/http.git">jedno z nich</a> ÄekÃ¡ na <a href="https://developer.github.com/webhooks/">pohlavek z internetu</a>, Å¾e by mÄ›lo stÃ¡hnout novÃ© zmÄ›ny, takÅ¾e kdyÅ¾ napÅ™Ã­klad v <em>16:01:15</em> poÅ¡lu zmÄ›nu na <em>server s kÃ³dem</em> (coÅ¾ je <em>jinÃ½</em> server, neÅ¾ ze kterÃ©ho bÄ›Å¾Ã­ <a href="https://www.drdplus.info">drdplus.info</a>), tak v <em>16:01:25</em>, po deseti sekundÃ¡ch, uÅ¾ je zmÄ›na veÅ™ejnÃ¡ a ty ji uvidÃ­Å¡ (protoÅ¾e <em>server s kÃ³dem</em> dal pohlavek <em>serveru se strÃ¡nkami</em> ve smyslu "dÃ¡vej bacha a stÃ¡hni si novou verzi").<br>
To hodnÄ› pomÃ¡hÃ¡, protoÅ¾e pak nemÃ¡m psychickÃ½ blok nasazovat zmÄ›ny hned, jako kdybych musel jeÅ¡tÄ› nÄ›kde "maÄkat tohleto a potvrzovat tÃ¡mhleto".</p>


<h4 id="je-to-o-energii"><a href="#je-to-o-energii" class="heading-anchor">Je to o energii</a></h4>


<p><em>Å½ivot je pÅ™elÃ©vÃ¡nÃ­ energie, tak s nÃ­ neplÃ½tvej</em></p>


<p>Jo, pravdou je, Å¾e kdybych se snaÅ¾il, tak to samÃ© zÃ­skÃ¡m s bÄ›Å¾nÃ½m <a href="https://httpd.apache.org/">Apache web serverem</a> a nemusel bych se se systÃ©mem prÃ¡t, kterÃ½ z tÄ›ch dvou webovÃ½ch programÅ¯ bude mÃ­t exkluzivnÃ­ prÃ¡vo na <a href="https://cs.wikipedia.org/wiki/Seznam_%C4%8D%C3%ADsel_port%C5%AF_TCP_a_UDP">port 443</a>, pÅ™es kterÃ½ to vÅ¡echno lÃ­tÃ¡ (coÅ¾ nakonec vyÃºstilo ke smazÃ¡nÃ­ Apache, coÅ¾ popravdÄ› taky nebylo ÃºplnÄ› samozÅ™ejmÃ©, jelikoÅ¾ ta potvora se drÅ¾Ã­ zuby nehty).</p>


<p>JenÅ¾e s <a href="https://caddyserver.com/">Caddy</a> jsem to mÄ›l hned a bez prÃ¡ce. Ano, dneska uÅ¾ <a href="https://httpd.apache.org/docs/2.4/mod/mod_http2.html">Apache podporuje HTTP/2</a> a zÃ­skÃ¡nÃ­ certifikÃ¡tu pro HTTPS zadarmo od <a href="https://letsencrypt.org/">Let's Encrypt</a> je <a href="https://www.root.cz/clanky/apache-pridava-podporu-let-s-encrypt-pro-https-staci-jeden-radek-konfigurace/">taky hraÄka</a>, ale pÅ™ed dvÄ›ma lety nebylo, nehledÄ› na to, Å¾e to automatickÃ© nasazovÃ¡nÃ­ novinek bych si musel napsat sÃ¡m.</p>


<h2 id="co-je-hotove-na-to-nesahame"><a href="#co-je-hotove-na-to-nesahame" class="heading-anchor">Co je hotovÃ©, na to neÅ¡ahÃ¡me</a></h2>


<p><em>StrÃ¡nka se posÃ­lala rychleji, ale neÅ¾ se posklÃ¡dala, pro kaÅ¾dÃ©ho znova a znova, to byla taky doba</em></p>


<p>ChtÄ›lo to keÅ¡ovat. Cache (Äti <em>keÅ¡</em>) je doÄasnÃ¡ pamÄ›Å¥ (nÄ›kdy jÃ­ Å™Ã­kÃ¡me taky <em>mezipamÄ›Å¥</em>), kterÃ¡ pÅ™edhodÃ­ uÅ¾ znÃ¡mÃ½ vÃ½sledek, aby se to nepoÄÃ­talo / nelepilo / nestahovalo znova. A ta mÃ¡ jednu dost oÅ¡klivou vlastnost, aÅ¥ uÅ¾ jde o mezipamÄ›Å¥ v hlavÄ› strÃ¡Å¾nÃ­ka, kterÃ½ si nepÅ™eÄetl novou vyhlÃ¡Å¡ku, nebo o chaotickou zmÄ›Å¥ bajtÅ¯ nÄ›kde v poÄÃ­taÄi.<br>
TÄ›Å¾ko se totiÅ¾ hledÃ¡ ten <strong>sprÃ¡vnÃ½</strong> okamÅ¾ik, kdy se to mÃ¡ vÅ¡echno zahodit a naÄÃ­st zase znova.</p>


<h3 id="slepa-kolej"><a href="#slepa-kolej" class="heading-anchor">SlepÃ¡ kolej</a></h3>


<p><em>KdyÅ¾ padneÅ¡ na hubu, zafÅˆukej si, zapamatuj si to a jdi dÃ¡l, rozumnÄ›jÅ¡Ã­ neÅ¾ kdy dÅ™Ã­v.</em></p>


<p>JÃ¡ to asi pÅ™ed rokem zkouÅ¡el s tehdy jeÅ¡tÄ› poÅ™Ã¡d populÃ¡rnÃ­, pÅ™estoÅ¾e uÅ¾ oznaÄenou jako <em>zastaralou</em>, <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Using_the_application_cache">aplikaÄnÃ­ keÅ¡Ã­</a>, coÅ¾ je technologie prohlÃ­Å¾eÄÅ¯, kterÃ¡ umoÅ¾Åˆuje <strong>celou</strong> strÃ¡nku uloÅ¾it pÄ›knÄ› na tvÃ© stranÄ› a kdykoli se chceÅ¡ na strÃ¡nku podÃ­vat znovu, pouÅ¾ije se ta pÅ™ed-uloÅ¾enÃ¡ strÃ¡nka z <strong>tvÃ©ho</strong> poÄÃ­taÄe, takÅ¾e je to pak bleskurychlÃ©, protoÅ¾e uÅ¾ se na nic z internetu neÄekÃ¡.<br>
A taky je peklo tu keÅ¡ zahodit, kdyÅ¾ se nÄ›co v obsahu zmÄ›nÃ­... a prÃ¡vÄ› proto, Å¾e si na tom rozbilo hubu uÅ¾ spousta lidÃ­, a jÃ¡ se pÅ™idal, tak je uÅ¾ delÅ¡Ã­ dobu tenhle zpÅ¯sob keÅ¡ovÃ¡nÃ­ oznaÄenÃ½ jako <em>zastaralÃ½</em>.</p>


<p>TakÅ¾e jsem si na tom spÃ¡lil prsty, vyhodil nÄ›kolik desÃ­tek hodin prÃ¡ce a celou tu slavnou <em>aplikaÄnÃ­ keÅ¡</em> zahodil.<br>
Ale zas jsem se nÄ›co pÅ™iuÄil a hlavnÄ› jsem pÅ™i tom zdokonalil keÅ¡ovÃ¡nÃ­ na <strong>stranÄ› serveru</strong> (to je ta magickÃ¡ krabiÄka nÄ›kde na druhÃ© stranÄ› drÃ¡tÅ¯, kterÃ¡ ti to vÅ¡echno posÃ­lÃ¡).</p>


<h2 id="kesovani-na-serveru"><a href="#kesovani-na-serveru" class="heading-anchor">KeÅ¡ovÃ¡nÃ­ na serveru</a></h2>


<p>2017</p>


<p><em>"NemÄ›l byste nÃ¡hodou..." "MÄ›l." "A nemÄ›l byste to spÃ­Å¡ s takovou tou..." "MÄ›l." "Pane jo, to asi nejsem prvnÃ­, kdo to chce, co?" "Ne."</em></p>


<p>MoÅ¾nÃ¡ mÃ¡Å¡ pocit, Å¾e nÄ›kde v internetu ÄekÃ¡ jedna celÃ¡, ÃºplnÄ› hotovÃ¡ strÃ¡nka. Obvykle to tak skuteÄnÄ› je, ale tu celou strÃ¡nku nedÃ¡vajÃ­ dohromady lidÃ©. My vytvÃ¡Å™Ã­me kousky a nechÃ¡vÃ¡me je lepit dohromady, protoÅ¾e upravovat celou tu strÃ¡nku najednou, z toho bychom se zcvokli.<br>
DÅ¯vody jsou dva:</p>


<ul>
<li>vÄ›tÅ¡ina strÃ¡nek mÃ¡ nÄ›co spoleÄnÃ©ho, vzhled, pravidla zobrazenÃ­ na mobilu, podmÃ­nky keÅ¡ovÃ¡nÃ­ na stranÄ› nÃ¡vÅ¡tÄ›vnÃ­ka
<ul>
<li>no kdo by se s tÃ­mhle psal dvakrÃ¡t, neÅ™ku-li jedenÃ¡ctkrÃ¡t jako v pÅ™Ã­padÄ› vÅ¡ech pravidlovÃ½ch a pÅ™Ã­bÄ›hovÃ½ch strÃ¡nek <a href="https://www.drdplus.info">drdplus.info</a>, to uznej</li>
</ul>
</li>
<li>obsah je opravdu rozsÃ¡hlÃ½
<ul>
<li>a upravovat nÄ›co s 24876 Å™Ã¡dky (souÄasnÃ¡ velikost <a href="https://pph.drdplus.info/?trial=1">PPH</a>) v jedinÃ©m souboru, to se fakt nedÃ¡</li>
</ul>
</li>
</ul>

<p>Proto mÃ¡m vytvoÅ™enÃ½ <a href="https://github.com/jaroslavtyc/drd-plus-rules-html-skeleton">spoleÄnÃ½ zÃ¡klad pro vÅ¡echny obsahovÃ© strÃ¡nky</a> (a <a href="https://github.com/jaroslavtyc/drd-plus-calculator-skeleton">dalÅ¡Ã­ pak pro kalkulÃ¡tory</a>),<br>
kde Å™eÅ¡Ã­m vÅ¡echno spoleÄnÃ©. Obsah samotnÃ½ mÃ¡m pak rozdÄ›lenÃ½ do souborÅ¯ podle selskÃ©ho rozumu, u kaÅ¾dÃ½ch pravidel zvlÃ¡Å¡Å¥, tÅ™eba <code>089a Volba zbroje.html</code>, <code>090a2 Tabulka zbrojÃ­ a pÅ™ileb.html</code>, <code>090a Tabulka zbrojÃ­ a pÅ™ileb - popis.html</code>, <code>090b PÅ™Ã­prava parametrÅ¯.html</code> a tak dÃ¡le (jo, Å™adÃ­m si to abecednÄ›).<br>
A tohle se samo poslepuje, vytvoÅ™Ã­ se z toho vÃ½slednÃ¡ celÃ¡ strÃ¡nka a ta se ti poÅ¡le.</p>


<p>A kdyÅ¾ uÅ¾ se to na serveru lepÃ­ vÅ¡echno dohromady, tak uÅ¾ je jen krÅ¯Äek k tomu, aby se to lepilo jen kdyÅ¾ je potÅ™eba a jinak to do svÄ›ta posÃ­lalo to, co uÅ¾ mÃ¡ z minula.</p>


<p>ZahazovÃ¡nÃ­ keÅ¡e je v tomhle pÅ™Ã­padÄ› krÃ¡snÄ› jednoduchÃ© - jakmile na server pÅ™istanou novÃ© zmÄ›ny (Äehokoli), tak se keÅ¡ smÃ¡zne (celÃ¡).</p>


<h3 id="jak-odkazy-pomohly-kesovat"><a href="#jak-odkazy-pomohly-kesovat" class="heading-anchor">Jak odkazy pomohly keÅ¡ovat</a></h3>


<p><em>KaÅ¾dÃ½ krok vpÅ™ed otevÅ™e dveÅ™e po stranÃ¡ch</em></p>


<p>StrÃ¡nka se na serveru keÅ¡ovala, fungovalo to, nebyl dÅ¯vod k dalÅ¡Ã­ zmÄ›nÄ›. Respektive nebyl by, kdyby mi nevadila jedna vÄ›c.<br>
Spousta nadpisÅ¯ a tabulek totiÅ¾ nemÄ›ly odkaz. KdyÅ¾ jsem chtÄ›l nÄ›komu poslat tÅ™eba tabulku rychlosti, musel jsem mu Å™Ã­ct Å¾e <em>"je to nÄ›kde dole"</em>.</p>


<p>TakÅ¾e jsem <a href="https://github.com/PhpGt/Dom">sehnal nÃ¡stroj</a>, kterÃ½ schroupe pÅ™ipravenou strÃ¡nku a nÄ›kolika mÃ¡lo pÅ™Ã­kazy nacpe ke vÅ¡em nadpisÅ¯m, aÅ¥ uÅ¾ kapitol nebo tabulek, automaticky vytvoÅ™enÃ½ odkaz. A hned bylo s <a href="https://pph.drdplus.info/?trial=1#tabulka_rychlosti">odkazovÃ¡nÃ­m na Tabulku rychlosti</a> veseleji.</p>


<p>KdyÅ¾ se nÄ›co zmÄ›nÃ­, tak se nÄ›co pokazÃ­, a protoÅ¾e mi to nedoÅ¡lo, tak jsem automatickÃ½mi odkazy sestÅ™elil <a href="https://pph.drdplus.info/?trial=1">Pravidla pro hrÃ¡Äe</a>. Ono totiÅ¾ <em>rozsekat</em> tak velkou HTML strÃ¡nku, jakou <a href="https://pph.drdplus.info/?trial=1">Pravidla pro hrÃ¡Äe</a> jsou, a kaÅ¾dÃ½ ten kousek popsat objektem v programu, tak to seÅ¾ere (alespoÅˆ v <a href="https://php.net">PHP</a>) dost RAMky a jako kaÅ¾dÃ½ sprÃ¡vnÄ› vychovanÃ½ program, tak i tenhle mÃ¡ pevnÄ› nastavenÃ½ limit, pÅ™es kterÃ½ vlak nejede. V tomhle pÅ™Ã­padÄ› to je <a href="https://php.net/manual/en/ini.core.php">vÃ½chozÃ­ch 128 MB</a>, coÅ¾ uÅ¾ nestaÄilo, strÃ¡nka padla a jÃ¡ na to pÅ™iÅ¡el aÅ¾ druhÃ½ den.<br>
Neboj, pro pÅ™Ã­Å¡tÄ› uÅ¾ jsem pojiÅ¡tÄ›nÃ½, testuji horem dolem funkÄnost strÃ¡nek nejen pÅ™ed tÃ­m, neÅ¾ zmÄ›ny zveÅ™ejnÃ­m, ale teÄ uÅ¾ i <a href="https://uptimerobot.com/">po jejich zveÅ™ejnÄ›nÃ­</a>, prÃ¡vÄ› abych se uÅ¾ takhle nenachytal (ale o testovÃ¡nÃ­ radÅ¡i jindy, to je pohÃ¡dka na dalÅ¡Ã­ dlouhou dobrou noc).</p>


<p>OvÅ¡em, kdyÅ¾ uÅ¾ jsem byl u tÃ© automatickÃ© zmÄ›ny obsahu (pÅ™idÃ¡vÃ¡nÃ­ odkazÅ¯ k nadpisÅ¯m), tak uÅ¾ staÄilo jen Å¾dibÃ­Äek, a najednou bylo vyÅ™eÅ¡eno zahazovÃ¡nÃ­ keÅ¡e ve tvÃ©m prohlÃ­Å¾eÄi pro kaÅ¾dou ÄÃ¡st, ze kterÃ© je strÃ¡nka posklÃ¡danÃ¡.<br>
A tak uklÃ¡dÃ¡nÃ­ strÃ¡nky na tvÃ© stranÄ›, ve tvÃ©m prohlÃ­Å¾eÄi, aby se to vÅ¡echno nenaÄÃ­talo poÅ™Ã¡d znova, zase dostalo po roce smysl.</p>


<h2 id="kesovani-v-prohlizeci"><a href="#kesovani-v-prohlizeci" class="heading-anchor">KeÅ¡ovÃ¡nÃ­ v prohlÃ­Å¾eÄi</a></h2>


<p>2018</p>


<p><em>"Ale to jsem jÃ¡, Karel pÅ™ece, co blbneÅ¡?" "Karel nosÃ­ kulichy bez bambulÃ­, ukaÅ¾te obÄanku"</em></p>


<p>Na serveru uÅ¾ jsem mÄ›l keÅ¡ovÃ¡nÃ­ vyÅ™eÅ¡enÃ© a mohl jsem se zas vÄ›novat keÅ¡ovÃ¡nÃ­ na tvÃ© stranÄ›, v prohlÃ­Å¾eÄi. A zmÄ›ny s automatickÃ½m pÅ™idÃ¡vÃ¡nÃ­m odkazÅ¯ mi ukÃ¡zaly smÄ›r.</p>


<p>Jak jsem psal na zaÄÃ¡tku, nejvÄ›tÅ¡Ã­m problÃ©mem u keÅ¡e je vychytat ten okamÅ¾ik, kdy se to mÃ¡ zahodit (ÃºplnÄ› novÃ½ rozmÄ›r dal tomuhle problÃ©mu (hlavnÄ›) Intel, kterÃ½ mÃ¡ v souÄasnosti zatracenÄ› velkÃ½ problÃ©m se svÃ½mi procesory, kterÃ© vlastnÄ› <a href="https://www.root.cz/clanky/jak-funguje-spectre-a-meltdown-linux-na-orange-pi-a-zmena-algoritmu-dnssec/">umoÅ¾ÅˆujÃ­ ÄÃ­st komukoli cokoli</a> - no, je to sloÅ¾itÃ©, ale zÃ¡kladnÃ­ kÃ¡men Ãºrazu je prÃ¡vÄ› touha keÅ¡ovat co nejvÃ­ce vÃ½sledkÅ¯ a co nejmÃ©nÄ› je zahazovat).</p>


<p>TakÅ¾e kdy se mÃ¡ zahodit keÅ¡ nÄ›jakÃ© ÄÃ¡sti strÃ¡nky? NapÅ™Ã­klad kdy se mÃ¡ naÄÃ­st novÃ½ <a href="https://bestiar.ppj.drdplus.info/images/175.png?version=6434d6bef64654cef24f5529516a16e4">obrÃ¡zek konÄ›</a>? KdyÅ¾ se zmÄ›nÃ­, jasnÄ›!<br>
K tomu se hodÃ­ prostÃ½ otisk obsahu, pro kterÃ½ kdysi dÃ¡vno (v roce 1991, coÅ¾ je v IT dÃ¡vno) vynalezl jeden chytrÃ½ pÃ¡n <a href="https://cs.wikipedia.org/wiki/Message-Digest_algorithm">algoritmus MD5</a>, kterÃ½ byl sice pÅ¯vodnÄ› urÄenÃ½ pro skrytÃ­ hesel a dalÅ¡Ã­ch dÅ¯vÄ›rnostÃ­, ale u kterÃ©ho uÅ¾ dÃ¡vno zjistili, Å¾e moc bezpeÄnÃ½ nenÃ­, a zÃ¡roveÅˆ Å¾e je fajn pro rychlÃ© zÃ­skÃ¡nÃ­ krÃ¡tkÃ©ho, unikÃ¡tnÃ­ho otisku (no dobÅ™e, <a href="https://www.root.cz/clanky/hasovaci-funkce-md5-a-dalsi-prolomeny/">pidi Å¡ance na kolizi tu je</a>) libovolnÄ› dlouhÃ©ho textu, obrÃ¡zku a vlastnÄ› jakÃ©hokoli obsahu.<br>
Fajn, tak mÃ¡m unikÃ¡tnÃ­ otisk souboru (tÅ™eba ona kresba konÄ› mÃ¡ <code>6434d6bef64654cef24f5529516a16e4</code>), ale co s tÃ­m? NÄ›koho by napadlo mÄ›nit pokaÅ¾dÃ© jmÃ©no souboru, protoÅ¾e prohlÃ­Å¾eÄ ho pak <strong>musÃ­</strong> naÄÃ­st, jelikoÅ¾ pod novÃ½m nÃ¡zvem nic keÅ¡ovanÃ©ho jeÅ¡tÄ› nemÃ¡, takÅ¾e co tÅ™eba <code>obrazek_kone_6434d6bef64654cef24f5529516a16e4.png</code>.</p>


<p>Ano, unikÃ¡tnÃ­ nÃ¡zev je zaruÄenÃ½ zpÅ¯sob, jak donutit prohlÃ­Å¾eÄ naÄÃ­st soubor znovu, i kdyby se liÅ¡il byÅ¥ jen o jedinÃ© pÃ­smenko, nebo u obrÃ¡zku o jedinÃ½ pixel, naÅ¡tÄ›stÃ­ ale nemusÃ­me skuteÄnÄ› <em>pÅ™ejmenovÃ¡vat</em> soubory, protoÅ¾e z toho by byl pÄ›knÃ½ bolehlav.<br>
StaÄÃ­ totiÅ¾ k webovÃ©mu odkazu, kterÃ½ ukazuje na chtÄ›nÃ½ soubor, nÄ›co unikÃ¡tnÃ­ho <em>pÅ™idat</em>. S obrÃ¡zkem konÄ› to pak vyÅ™eÅ¡Ã­m zmÄ›nou odkazu na <code>obrazek_kone.png?6434d6bef64654cef24f5529516a16e4</code></p>


<ul>
<li>pÅ™ed otaznÃ­kem je nÃ¡zev souboru, kterÃ½ se <strong>nemÄ›nÃ­</strong>
</li>
<li>za otaznÃ­kem je takzvanÃ½ <a href="https://en.wikipedia.org/wiki/Query_string">query string (asi <em>Å™etÄ›zec dotazu</em>?)</a>, kde mÅ¯Å¾e bÃ½t vlastnÄ› cokoliv a kdyÅ¾ je to celÃ© <em>dohromady</em> pro tvÅ¯j prohlÃ­Å¾eÄ nÄ›co novÃ©ho, tak to povaÅ¾uje za <em>novÃ½</em> odkaz, kterÃ½ <strong>musÃ­</strong> naÄÃ­st</li>
</ul>

<p>a zahazovÃ¡nÃ­ keÅ¡e je vyÅ™eÅ¡eno.</p>


<p>DalÅ¡Ã­ velkou vÃ½hodou je, Å¾e takhle rozÅ¡Ã­Å™enÃ½ odkaz na soubor platÃ­ poÅ™Ã¡d, i kdyÅ¾ uÅ¾ je jeho otisk dÃ¡vno jinÃ½, protoÅ¾e nÃ¡zev souboru je vlastnÄ› poÅ™Ã¡d stejnÃ½ a sprÃ¡vnÃ½ (samotnÃ½ <code>obrazek_kone.png</code> poÅ™Ã¡d existuje, aÅ¥ uÅ¾ mÃ¡ otisk jakÃ½koli, schvÃ¡lnÄ› <a href="https://bestiar.ppj.drdplus.info/images/175.png?version=u%C5%BE_m%C4%9B_kon%C4%9B_vedou">si to zkus</a>).</p>


<p>VÃ½sledkem je napÅ™Ã­klad u <a href="https://pph.drdplus.info/?trial=1">Pravidel pro hrÃ¡Äe</a> namÃ­sto pÅ™enesenÃ½ch 13.1 MB pouhÃ½ch 0.4 MB (pouhÃ¡ 3 %) a mÃ­sto 17.5 sekundy jenom 7.5 sekundy (je to pÅ™eci jen velkÃ¡ strÃ¡nka a prohlÃ­Å¾eÄ se zapotÃ­, neÅ¾ ji posklÃ¡dÃ¡, i kdyÅ¾ uÅ¾ o nÃ­ <em>vÅ¡echno</em> vÃ­).<br>
A kdyÅ¾ nÄ›co zmÄ›nÃ­m, napÅ™Ã­klad vzhled odkazÅ¯, tak se ti stÃ¡hne jen ten zmÄ›nÄ›nÃ½ mrÅˆavÃ½ <a href="https://pph.drdplus.info/css/generic/anchors.css?version=f430266ecbf9ceaddc17690121fcb2f5">soubor se vzhledem (styly)</a>. A to se poÄÃ­tÃ¡!</p>


<h3 id="vanocni-uklid"><a href="#vanocni-uklid" class="heading-anchor">VÃ¡noÄnÃ­ Ãºklid</a></h3>


<p>Inu, pravdou je, Å¾e ti na disku zÅ¯stane ta <em>starÃ¡ verze</em> souboru, protoÅ¾e tvÅ¯j prohlÃ­Å¾eÄ vlastnÄ› <em>nevÃ­</em>, Å¾e uÅ¾ to nepotÅ™ebuje (nikdo mu to neÅ™ekl), ale to uÅ¾ se jaksi moc neÅ™eÅ¡Ã­, pardon...</p>


<p>JÃ¡ to napÅ™Ã­klad keÅ¡uji na rok, takÅ¾e "samo" se ti to smaÅ¾e z disku za 356 dnÃ­, nebo kdyÅ¾ to vÃ½slovnÄ› prohlÃ­Å¾eÄi pÅ™ikÃ¡Å¾eÅ¡, ale s mazÃ¡nÃ­m historie buÄ opatrnÃ½, mÅ¯Å¾eÅ¡ si omylem smazat tÅ™eba hesla, uloÅ¾enÃ¡ k oblÃ­benÃ½m strÃ¡nkÃ¡m.</p>


<h2 id="hudba-budoucnosti"><a href="#hudba-budoucnosti" class="heading-anchor">Hudba budoucnosti</a></h2>


<p>2019</p>


<p>Tohle vÅ¡echno smÄ›Å™uje, ÄÃ¡steÄnÄ› samovolnÄ› a podvÄ›domÄ›, ÄÃ¡steÄnÄ› Å™Ã­zenÄ›, ke strÃ¡nkÃ¡m dostupnÃ½m i bez internetovÃ©ho pÅ™ipojenÃ­. Jak si je jednou naÄteÅ¡, uÅ¾ je budeÅ¡ mÃ­t v prohlÃ­Å¾eÄi uloÅ¾enÃ© a pÅ™i kaÅ¾dÃ© dalÅ¡Ã­ nÃ¡vÅ¡tÄ›vÄ›, kdybys tÅ™eba jel vlakem pÅ™es Pavlov, zasypala tÄ› lavina, zavÅ™eli tÄ› do <a href="https://www.mobilmania.cz/clanky/mobil-v-aute-a-faradayova-klec/sc-3-a-1108499/default.aspx">Faradaiovy klece</a> nebo tÄ› postihla podobnÃ¡ offline katastrofa, tak se ti <a href="https://www.drdplus.info">drdplus.info</a> a vÅ¡echna jeho pravidla (kterÃ¡ uÅ¾ sis nÄ›kdy naÄetl) budou poÅ™Ã¡d naÄÃ­tat.</p>


<p>Ale k tomu se jeÅ¡tÄ› musÃ­m dopracovat, jelikoÅ¾ se budu se muset nauÄit <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">javascriptovÃ© Web workers</a>.<br>
Jakmile to ale zvlÃ¡dneme, tak se skokovÄ› pÅ™iblÃ­Å¾Ã­me k dalÅ¡Ã­mu milnÃ­ku - mÃ­t pravidla v telefonu jako <em>mobilnÃ­ aplikaci</em>.</p>


<p>KrleÅ¡!</p>

        <br>

        
        <div class="licence">
            <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"
               title="Toto dÃ­lo podlÃ©hÃ¡ licenci Creative Commons, UveÄte pÅ¯vod, 4.0 MezinÃ¡rodnÃ­ Licence">
                <img alt="Licence Creative Commons" style="border-width:0"
                     src="/assets/images/CC-BY.png?version=229daa2bfc2444f20a57a2deabf6522d"/>
            </a>
        </div>

                                            <div class="card mb-5 mt-4">
                <div class="card-deck">
                                            <div class="card-body text-left">
                            <a href="/blog/2018/02/16/vyskytla_se_nam_neviditelna_soutez/">
                                <em>
                                    &lt;&lt;
                                    <span class="hidden-sm-down">16. 2. 2018</span>
                                    Vyskytla se nÃ¡m NeviditelnÃ¡ soutÄ›Å¾
                                </em>
                            </a>
                        </div>
                                                                <div class="card-body text-right">
                            <a href="/blog/2018/05/03/neviditelna_recenze/">
                                <em>
                                    <span class="hidden-sm-down">3. 5. 2018</span>
                                    NeviditelnÃ¡ recenze
                                    &gt;&gt;
                                </em>
                            </a>
                        </div>
                                    </div>
            </div>
        
        <div class="mb-5 hidden-sm-down text-center">
            <a href="https://github.com/drdplusinfo/blog/edit/master/source/_posts/2018/2018-03-10-technicky_milnik_zrychlili_jsme.md" class="btn btn-warning btn-sm">
                <em class="fas fa-fw fa-edit"></em>
                Oprav pÅ™eklep, zachrÃ¡nÃ­Å¡ mozkovou buÅˆku
            </a>
        </div>

        <a name="comments"></a>

        <div id="disqus_thread"></div>

<script type="text/javascript">
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//' + 'blog-drdplus-info' + '.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
    </div>

    <script id="dsq-count-scr" src="https://blog-drdplus-info.disqus.com/count.js" async defer></script>
</div>

<script src="/assets/js/jquery-3.3.1.slim.min.js?=1738423912"></script>
<script src="/assets/gifplayer/jquery.gifplayer.js?=1239257880"></script>
<script src="/assets/js/cluster-checklist.js?=1092351771"></script>
<script src="/assets/js/cluster-expanable.js?=2082328259"></script>

<script>
    ga=function(){ ga.q.push(arguments) };
    ga.q=[];
    ga.l=+new Date;
    ga('create', 'UA-121206931-1', 'auto');
    ga('send','pageview');
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>

<script src="/assets/prism/prism.js"></script>

<script>
    $('.gifplayer').gifplayer();
</script>

<div class="text-center mt-5" id="footer">
    <p>
        
        <span class="hidden-sm-down">
            <span class="pl-2 pr-2">â€¢</span>
            DigitÃ¡lnÃ­ koleÄka roztÃ¡ÄÃ­ <a href="https://www.statie.org/">Statie</a>

            <span class="pl-2 pr-2">â€¢</span>
            KÃ³dy skladujeme na <a href="https://github.com/drdplusinfo">GitHubu</a>
        </span>
    </p>
</div>
</body>
</html>
